{
  "db": "PostgreSQL",
  "026e967798e1b5e4a165d1a09581c5483bc944b850ba31599088aec22082c298": {
    "describe": {
      "columns": [
        {
          "name": "id: TaskId",
          "ordinal": 0,
          "type_info": "Int4"
        },
        {
          "name": "completed_at",
          "ordinal": 1,
          "type_info": "Timestamp"
        }
      ],
      "nullable": [
        false,
        true
      ],
      "parameters": {
        "Left": [
          "Int4",
          "Int4",
          "Bool"
        ]
      }
    },
    "query": "\n                UPDATE\n                    tasks t\n                SET\n                    completed_at = CASE\n                        WHEN $3 THEN CURRENT_TIMESTAMP AT TIME ZONE 'UTC'\n                        ELSE NULL\n                    END\n                WHERE\n                    t.id = $2 AND\n                    -- Permission check\n                    (\n                        -- Viewer is responsible\n                        t.responsible_user_id = $1 OR\n                        -- Viewer is in task group\n                        EXISTS (\n                            SELECT\n                            FROM\n                                users_groups ug\n                            WHERE\n                                ug.group_id = t.group_id AND\n                                ug.user_id = $1\n                        )\n                    )\n                RETURNING\n                    id as \"id: TaskId\",\n                    completed_at\n            "
  },
  "0d2d3db1a852fc49a0334ad071c79524a3ab0434614dd330569b7d2b4dbecd7a": {
    "describe": {
      "columns": [
        {
          "name": "?column?",
          "ordinal": 0,
          "type_info": "Bool"
        }
      ],
      "nullable": [
        null
      ],
      "parameters": {
        "Left": [
          "Int4",
          "Int4",
          "Int4"
        ]
      }
    },
    "query": "\n                    SELECT\n                        -- Viewer in group\n                        EXISTS (\n                            SELECT\n                            FROM\n                                users_groups\n                            WHERE\n                                user_id = $1 AND\n                                group_id = $3\n                        ) AND\n                        -- Responsible in group\n                        EXISTS (\n                            SELECT\n                            FROM\n                                users_groups\n                            WHERE\n                                user_id = $2 AND\n                                group_id = $3\n                        )\n                "
  },
  "12fc47eaed77983b8e993e5be858d0bf846045409a702bdc554e9e624d7a7dcc": {
    "describe": {
      "columns": [
        {
          "name": "id: TaskId",
          "ordinal": 0,
          "type_info": "Int4"
        }
      ],
      "nullable": [
        false
      ],
      "parameters": {
        "Left": [
          "Int4",
          "Int4",
          "Text",
          "Date",
          "Date",
          "Int4",
          "Int4",
          "Interval"
        ]
      }
    },
    "query": "\n                UPDATE\n                    tasks t\n                SET\n                    title = $3,\n                    start_date = $4,\n                    end_date = $5,\n                    responsible_user_id = $6,\n                    group_id = $7,\n                    estimate = $8\n                WHERE\n                    t.id = $2 AND\n                    -- Permission check\n                    (\n                        -- Viewer is responsible\n                        t.responsible_user_id = $1 OR\n                        -- Viewer is in task group\n                        EXISTS (\n                            SELECT\n                            FROM\n                                users_groups ug\n                            WHERE\n                                ug.group_id = t.group_id AND\n                                ug.user_id = $1\n                        )\n                    )\n                RETURNING\n                    id as \"id: TaskId\"\n            "
  },
  "14fd4db15ffa6910b8d4f3a085902a2194222e8dbda540674c23542e2bfb9f7e": {
    "describe": {
      "columns": [
        {
          "name": "id: GroupId",
          "ordinal": 0,
          "type_info": "Int4"
        },
        {
          "name": "title",
          "ordinal": 1,
          "type_info": "Text"
        },
        {
          "name": "uid",
          "ordinal": 2,
          "type_info": "Uuid"
        }
      ],
      "nullable": [
        false,
        false,
        false
      ],
      "parameters": {
        "Left": [
          "Int4"
        ]
      }
    },
    "query": "\n                SELECT\n                    g.id as \"id: GroupId\",\n                    g.title,\n                    g.uid\n                FROM\n                    groups g\n                INNER JOIN\n                    users_groups ug ON\n                        ug.group_id = g.id\n                WHERE\n                    ug.user_id = $1\n            "
  },
  "1e59d0bc0b19919938c42f0ddc1f24e1411a9546a0d5d53c0e4b1f8ba3cf686b": {
    "describe": {
      "columns": [
        {
          "name": "id: TaskId",
          "ordinal": 0,
          "type_info": "Int4"
        }
      ],
      "nullable": [
        false
      ],
      "parameters": {
        "Left": [
          "Int4",
          "Text",
          "Date",
          "Date",
          "Int4",
          "Interval"
        ]
      }
    },
    "query": "\n                INSERT INTO tasks (\n                    responsible_user_id,\n                    title,\n                    start_date,\n                    end_date,\n                    group_id,\n                    estimate\n                )\n                VALUES (\n                    $1,\n                    $2,\n                    $3,\n                    $4,\n                    $5,\n                    $6\n                )\n                RETURNING\n                    id as \"id: TaskId\"\n            "
  },
  "33fb99aa9fd2ae03664e2ab838df099e673912f61ae5eff025a3ea5e5507909b": {
    "describe": {
      "columns": [],
      "nullable": [],
      "parameters": {
        "Left": [
          "Int4",
          "Int4"
        ]
      }
    },
    "query": "\n                UPDATE\n                    tasks t\n                SET\n                    group_id = NULL\n                WHERE\n                    t.responsible_user_id = $1 AND\n                    t.group_id = $2\n            "
  },
  "4ebe4f8512bab12d12bef9622cb8a2abd1dcb7d4b346f24317888a669ac1019b": {
    "describe": {
      "columns": [],
      "nullable": [],
      "parameters": {
        "Left": [
          "Int4"
        ]
      }
    },
    "query": "\n                DELETE FROM\n                    groups g\n                WHERE\n                    id = $1 AND\n                    NOT EXISTS (\n                        SELECT\n                        FROM\n                            users_groups ug\n                        WHERE\n                            ug.group_id = g.id\n                    )\n            "
  },
  "521c3dae6edfe63489b2baed1171754f675afaf49f600f1951d10f8696566036": {
    "describe": {
      "columns": [
        {
          "name": "id: TaskId",
          "ordinal": 0,
          "type_info": "Int4"
        },
        {
          "name": "title",
          "ordinal": 1,
          "type_info": "Text"
        },
        {
          "name": "completed_at",
          "ordinal": 2,
          "type_info": "Timestamp"
        },
        {
          "name": "start_date",
          "ordinal": 3,
          "type_info": "Date"
        },
        {
          "name": "end_date",
          "ordinal": 4,
          "type_info": "Date"
        },
        {
          "name": "estimate",
          "ordinal": 5,
          "type_info": "Interval"
        },
        {
          "name": "responsible_id: UserId",
          "ordinal": 6,
          "type_info": "Int4"
        },
        {
          "name": "responsible_name",
          "ordinal": 7,
          "type_info": "Text"
        },
        {
          "name": "responsible_picture_url",
          "ordinal": 8,
          "type_info": "Text"
        },
        {
          "name": "group_id: Option<GroupId>",
          "ordinal": 9,
          "type_info": "Int4"
        },
        {
          "name": "group_title: Option<String>",
          "ordinal": 10,
          "type_info": "Text"
        },
        {
          "name": "group_uid: Option<Uuid>",
          "ordinal": 11,
          "type_info": "Uuid"
        }
      ],
      "nullable": [
        false,
        true,
        true,
        true,
        true,
        true,
        false,
        false,
        true,
        false,
        false,
        false
      ],
      "parameters": {
        "Left": [
          "Int4"
        ]
      }
    },
    "query": "\n                SELECT\n                    t.id as \"id: TaskId\",\n                    t.title,\n                    t.completed_at,\n                    t.start_date,\n                    t.end_date,\n                    t.estimate,\n                    u.id as \"responsible_id: UserId\",\n                    u.name as responsible_name,\n                    u.picture_url as responsible_picture_url,\n                    g.id as \"group_id: Option<GroupId>\",\n                    g.title as \"group_title: Option<String>\",\n                    g.uid as \"group_uid: Option<Uuid>\"\n                FROM\n                    tasks t\n                INNER JOIN\n                    users u ON\n                        u.id = t.responsible_user_id\n                LEFT JOIN\n                    groups g ON\n                        g.id = t.group_id\n                WHERE\n                    t.id = $1\n            "
  },
  "6ce4ba473682291f826b9ce5d2294132014c9b7948993827ca9e5ffa34355523": {
    "describe": {
      "columns": [
        {
          "name": "id: UserId",
          "ordinal": 0,
          "type_info": "Int4"
        },
        {
          "name": "uid",
          "ordinal": 1,
          "type_info": "Text"
        },
        {
          "name": "name",
          "ordinal": 2,
          "type_info": "Text"
        },
        {
          "name": "picture_url",
          "ordinal": 3,
          "type_info": "Text"
        }
      ],
      "nullable": [
        false,
        false,
        false,
        true
      ],
      "parameters": {
        "Left": [
          "Text",
          "Text",
          "Text"
        ]
      }
    },
    "query": "\n                INSERT INTO users (\n                    uid,\n                    name,\n                    picture_url\n                )\n                VALUES (\n                    $1,\n                    $2,\n                    $3\n                )\n                ON CONFLICT (uid) DO UPDATE SET\n                    name = EXCLUDED.name,\n                    picture_url = EXCLUDED.picture_url\n                RETURNING\n                    id as \"id: UserId\",\n                    uid,\n                    name,\n                    picture_url\n            "
  },
  "75b91b71d0393dffce807e6ccd0bd40de85b88ada9d9d496ed3b1a95ebc8b6a4": {
    "describe": {
      "columns": [
        {
          "name": "id: UserId",
          "ordinal": 0,
          "type_info": "Int4"
        },
        {
          "name": "uid",
          "ordinal": 1,
          "type_info": "Text"
        },
        {
          "name": "name",
          "ordinal": 2,
          "type_info": "Text"
        },
        {
          "name": "picture_url",
          "ordinal": 3,
          "type_info": "Text"
        }
      ],
      "nullable": [
        false,
        false,
        false,
        true
      ],
      "parameters": {
        "Left": [
          "Int4",
          "Int4"
        ]
      }
    },
    "query": "\n                SELECT\n                    u.id as \"id: UserId\",\n                    u.uid,\n                    u.name,\n                    u.picture_url\n                FROM\n                    users u\n                INNER JOIN\n                    users_groups ug ON\n                        ug.user_id = u.id\n                WHERE\n                    ug.group_id = $2 AND\n                    EXISTS (\n                        SELECT\n                        FROM\n                            users_groups viewer_groups\n                        WHERE\n                            viewer_groups.user_id = $1 AND\n                            viewer_groups.group_id = $2\n                    )\n            "
  },
  "89634b2042189f891057f5fd5072eb4d6ca3067ec863fca212aca81df06880bf": {
    "describe": {
      "columns": [
        {
          "name": "id: TaskId",
          "ordinal": 0,
          "type_info": "Int4"
        }
      ],
      "nullable": [
        false
      ],
      "parameters": {
        "Left": [
          "Int4",
          "Int4"
        ]
      }
    },
    "query": "\n                DELETE FROM\n                    tasks t\n                WHERE\n                    t.id = $2 AND\n                    -- Permission check\n                    (\n                        -- Viewer is responsible\n                        t.responsible_user_id = $1 OR\n                        -- Viewer is in task group\n                        EXISTS (\n                            SELECT\n                            FROM\n                                users_groups ug\n                            WHERE\n                                ug.group_id = t.group_id AND\n                                ug.user_id = $1\n                        )\n                    )\n                RETURNING\n                    id as \"id: TaskId\"\n            "
  },
  "959dd1255da06b62f8350e2c1735f617ab83305fc0a274fa8c25ea1229297df0": {
    "describe": {
      "columns": [
        {
          "name": "id: GroupId",
          "ordinal": 0,
          "type_info": "Int4"
        },
        {
          "name": "title",
          "ordinal": 1,
          "type_info": "Text"
        },
        {
          "name": "uid",
          "ordinal": 2,
          "type_info": "Uuid"
        }
      ],
      "nullable": [
        false,
        false,
        false
      ],
      "parameters": {
        "Left": [
          "Text"
        ]
      }
    },
    "query": "\n                INSERT INTO groups (\n                    title\n                )\n                VALUES (\n                    $1\n                )\n                RETURNING\n                    id as \"id: GroupId\",\n                    title,\n                    uid\n            "
  },
  "9f4f3758dc89a08a53045521025882b21400c4e8c28369c3778dbf35a43a6f47": {
    "describe": {
      "columns": [
        {
          "name": "id: GroupId",
          "ordinal": 0,
          "type_info": "Int4"
        },
        {
          "name": "title",
          "ordinal": 1,
          "type_info": "Text"
        },
        {
          "name": "uid",
          "ordinal": 2,
          "type_info": "Uuid"
        }
      ],
      "nullable": [
        false,
        false,
        false
      ],
      "parameters": {
        "Left": [
          "Int4",
          "Int4",
          "Text"
        ]
      }
    },
    "query": "\n                UPDATE\n                    groups g\n                SET\n                    title = $3\n                WHERE\n                    g.id = $2 AND\n                    EXISTS (\n                        SELECT\n                        FROM\n                            users_groups ug\n                        WHERE\n                            ug.group_id = g.id AND\n                            ug.user_id = $1\n                    )\n                RETURNING\n                    id as \"id: GroupId\",\n                    title,\n                    uid\n            "
  },
  "b5ed7df19e5ede92f355694fa31c4e8705912b793047812d28daf6c98b0073ed": {
    "describe": {
      "columns": [
        {
          "name": "id: GroupId",
          "ordinal": 0,
          "type_info": "Int4"
        },
        {
          "name": "title",
          "ordinal": 1,
          "type_info": "Text"
        },
        {
          "name": "uid",
          "ordinal": 2,
          "type_info": "Uuid"
        }
      ],
      "nullable": [
        false,
        false,
        false
      ],
      "parameters": {
        "Left": [
          "Uuid"
        ]
      }
    },
    "query": "\n                SELECT\n                    id as \"id: GroupId\",\n                    title,\n                    uid\n                FROM\n                    groups\n                WHERE\n                    uid = $1\n            "
  },
  "c42b3fe3bb44ec88e797bcba34bd09e399ee1feb4f61f847a77b21f95cf0ab9e": {
    "describe": {
      "columns": [],
      "nullable": [],
      "parameters": {
        "Left": [
          "Int4",
          "Int4"
        ]
      }
    },
    "query": "\n                DELETE FROM\n                    users_groups ug\n                WHERE\n                    ug.user_id = $1 AND\n                    ug.group_id = $2\n            "
  },
  "c69f2e7d3374e4881e9f0b7d13351e8646b318f1d4e3563545921190a8341f11": {
    "describe": {
      "columns": [],
      "nullable": [],
      "parameters": {
        "Left": [
          "Int4",
          "Int4"
        ]
      }
    },
    "query": "\n                INSERT INTO users_groups (\n                    user_id,\n                    group_id\n                )\n                VALUES (\n                    $1,\n                    $2\n                )\n            "
  },
  "d39057d752cc3ac67d525f172495b8458f203491513d843cbb03501dc5cfd84d": {
    "describe": {
      "columns": [
        {
          "name": "id: TaskId",
          "ordinal": 0,
          "type_info": "Int4"
        },
        {
          "name": "title",
          "ordinal": 1,
          "type_info": "Text"
        },
        {
          "name": "completed_at",
          "ordinal": 2,
          "type_info": "Timestamp"
        },
        {
          "name": "start_date",
          "ordinal": 3,
          "type_info": "Date"
        },
        {
          "name": "end_date",
          "ordinal": 4,
          "type_info": "Date"
        },
        {
          "name": "estimate",
          "ordinal": 5,
          "type_info": "Interval"
        },
        {
          "name": "responsible_id: UserId",
          "ordinal": 6,
          "type_info": "Int4"
        },
        {
          "name": "responsible_name",
          "ordinal": 7,
          "type_info": "Text"
        },
        {
          "name": "responsible_picture_url",
          "ordinal": 8,
          "type_info": "Text"
        },
        {
          "name": "group_id: Option<GroupId>",
          "ordinal": 9,
          "type_info": "Int4"
        },
        {
          "name": "group_title: Option<String>",
          "ordinal": 10,
          "type_info": "Text"
        },
        {
          "name": "group_uid: Option<Uuid>",
          "ordinal": 11,
          "type_info": "Uuid"
        }
      ],
      "nullable": [
        false,
        true,
        true,
        true,
        true,
        true,
        false,
        false,
        true,
        false,
        false,
        false
      ],
      "parameters": {
        "Left": [
          "Int4"
        ]
      }
    },
    "query": "\n                SELECT\n                    t.id as \"id: TaskId\",\n                    t.title,\n                    t.completed_at,\n                    t.start_date,\n                    t.end_date,\n                    t.estimate,\n                    u.id as \"responsible_id: UserId\",\n                    u.name as responsible_name,\n                    u.picture_url as responsible_picture_url,\n                    g.id as \"group_id: Option<GroupId>\",\n                    g.title as \"group_title: Option<String>\",\n                    g.uid as \"group_uid: Option<Uuid>\"\n                FROM\n                    tasks t\n                INNER JOIN\n                    users u ON\n                        u.id = t.responsible_user_id\n                LEFT JOIN\n                    groups g ON\n                        g.id = t.group_id\n                WHERE\n                    -- Hide old items\n                    (\n                        t.completed_at IS NULL OR\n                        t.completed_at > CURRENT_TIMESTAMP - INTERVAL '1 day'\n                    ) AND\n                    -- Permission check\n                    (\n                        -- Viewer is responsible\n                        t.responsible_user_id = $1 OR\n                        -- Viewer is in task group\n                        EXISTS (\n                            SELECT\n                            FROM\n                                users_groups ug\n                            WHERE\n                                ug.group_id = t.group_id AND\n                                ug.user_id = $1\n                        )\n                    )\n            "
  },
  "fb96380621e3048061609e3559381bbd403769f8caa2b0afa4235ce2d791936d": {
    "describe": {
      "columns": [
        {
          "name": "id: UserId",
          "ordinal": 0,
          "type_info": "Int4"
        }
      ],
      "nullable": [
        false
      ],
      "parameters": {
        "Left": [
          "Text"
        ]
      }
    },
    "query": "\n                INSERT INTO users (\n                    uid,\n                    name\n                )\n                VALUES (\n                    $1,\n                    '?'\n                )\n                ON CONFLICT (uid) DO UPDATE SET\n                    -- No-op to allow RETURNING\n                    uid = EXCLUDED.uid\n                RETURNING\n                    id as \"id: UserId\"\n            "
  }
}