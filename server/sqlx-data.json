{
  "db": "PostgreSQL",
  "0d2d3db1a852fc49a0334ad071c79524a3ab0434614dd330569b7d2b4dbecd7a": {
    "describe": {
      "columns": [
        {
          "name": "?column?",
          "ordinal": 0,
          "type_info": "Bool"
        }
      ],
      "nullable": [
        null
      ],
      "parameters": {
        "Left": [
          "Int4",
          "Int4",
          "Int4"
        ]
      }
    },
    "query": "\n                    SELECT\n                        -- Viewer in group\n                        EXISTS (\n                            SELECT\n                            FROM\n                                users_groups\n                            WHERE\n                                user_id = $1 AND\n                                group_id = $3\n                        ) AND\n                        -- Responsible in group\n                        EXISTS (\n                            SELECT\n                            FROM\n                                users_groups\n                            WHERE\n                                user_id = $2 AND\n                                group_id = $3\n                        )\n                "
  },
  "0ebdc4706c94417fd03eb4fd1d0ce7dbd9dad5cbd4a3fddcd89791aee30df8d7": {
    "describe": {
      "columns": [
        {
          "name": "id: UserId",
          "ordinal": 0,
          "type_info": "Int4"
        },
        {
          "name": "uid",
          "ordinal": 1,
          "type_info": "Text"
        },
        {
          "name": "name",
          "ordinal": 2,
          "type_info": "Text"
        },
        {
          "name": "picture_url",
          "ordinal": 3,
          "type_info": "Text"
        }
      ],
      "nullable": [
        false,
        false,
        false,
        true
      ],
      "parameters": {
        "Left": [
          "Int4",
          "Int4"
        ]
      }
    },
    "query": "\n                SELECT\n                    u.id as \"id: UserId\",\n                    u.uid,\n                    u.name,\n                    u.picture_url\n                FROM\n                    users u\n                INNER JOIN\n                    users_groups ug ON\n                        ug.user_id = u.id\n                WHERE\n                    ug.group_id = $2 AND\n                    EXISTS (\n                        SELECT\n                        FROM\n                            users_groups viewer_groups\n                        WHERE\n                            viewer_groups.user_id = $1 AND\n                            viewer_groups.group_id = $2\n                    )\n                ORDER BY\n                    u.created_at\n            "
  },
  "12fc47eaed77983b8e993e5be858d0bf846045409a702bdc554e9e624d7a7dcc": {
    "describe": {
      "columns": [
        {
          "name": "id: TaskId",
          "ordinal": 0,
          "type_info": "Int4"
        }
      ],
      "nullable": [
        false
      ],
      "parameters": {
        "Left": [
          "Int4",
          "Int4",
          "Text",
          "Date",
          "Date",
          "Int4",
          "Int4",
          "Interval"
        ]
      }
    },
    "query": "\n                UPDATE\n                    tasks t\n                SET\n                    title = $3,\n                    start_date = $4,\n                    end_date = $5,\n                    responsible_user_id = $6,\n                    group_id = $7,\n                    estimate = $8\n                WHERE\n                    t.id = $2 AND\n                    -- Permission check\n                    (\n                        -- Viewer is responsible\n                        t.responsible_user_id = $1 OR\n                        -- Viewer is in task group\n                        EXISTS (\n                            SELECT\n                            FROM\n                                users_groups ug\n                            WHERE\n                                ug.group_id = t.group_id AND\n                                ug.user_id = $1\n                        )\n                    )\n                RETURNING\n                    id as \"id: TaskId\"\n            "
  },
  "1bc3656027a772e1e3a63fb9b86cd0a5c67ab6f48cc9a9e423ead31b05a2cd8a": {
    "describe": {
      "columns": [
        {
          "name": "id",
          "ordinal": 0,
          "type_info": "Int4"
        },
        {
          "name": "title",
          "ordinal": 1,
          "type_info": "Text"
        },
        {
          "name": "is_responsible",
          "ordinal": 2,
          "type_info": "Bool"
        },
        {
          "name": "is_in_group",
          "ordinal": 3,
          "type_info": "Bool"
        },
        {
          "name": "completed_at",
          "ordinal": 4,
          "type_info": "Timestamp"
        },
        {
          "name": "is_old",
          "ordinal": 5,
          "type_info": "Bool"
        },
        {
          "name": "start_date",
          "ordinal": 6,
          "type_info": "Date"
        },
        {
          "name": "end_date",
          "ordinal": 7,
          "type_info": "Date"
        },
        {
          "name": "estimate",
          "ordinal": 8,
          "type_info": "Interval"
        },
        {
          "name": "category_id",
          "ordinal": 9,
          "type_info": "Int4"
        },
        {
          "name": "subcategory_id",
          "ordinal": 10,
          "type_info": "Int4"
        },
        {
          "name": "responsible_id",
          "ordinal": 11,
          "type_info": "Int4"
        },
        {
          "name": "responsible_name",
          "ordinal": 12,
          "type_info": "Text"
        },
        {
          "name": "responsible_picture_url",
          "ordinal": 13,
          "type_info": "Text"
        },
        {
          "name": "group_id: Option<i32>",
          "ordinal": 14,
          "type_info": "Int4"
        },
        {
          "name": "group_title: Option<String>",
          "ordinal": 15,
          "type_info": "Text"
        },
        {
          "name": "group_uid: Option<Uuid>",
          "ordinal": 16,
          "type_info": "Uuid"
        },
        {
          "name": "recurrence_id: Option<i32>",
          "ordinal": 17,
          "type_info": "Int4"
        },
        {
          "name": "recurrence_frequency: Option<PgInterval>",
          "ordinal": 18,
          "type_info": "Interval"
        },
        {
          "name": "recurrence_is_every: Option<bool>",
          "ordinal": 19,
          "type_info": "Bool"
        },
        {
          "name": "recurrence_current_task_id: Option<i32>",
          "ordinal": 20,
          "type_info": "Int4"
        },
        {
          "name": "recurrence_previous_task_id",
          "ordinal": 21,
          "type_info": "Int4"
        },
        {
          "name": "recurrence_num_ready_to_start",
          "ordinal": 22,
          "type_info": "Int4"
        },
        {
          "name": "recurrence_num_reached_deadline",
          "ordinal": 23,
          "type_info": "Int4"
        }
      ],
      "nullable": [
        false,
        false,
        null,
        null,
        true,
        null,
        true,
        true,
        true,
        true,
        false,
        false,
        false,
        true,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        true,
        null,
        null
      ],
      "parameters": {
        "Left": [
          "Int4",
          "Int4",
          "Int4"
        ]
      }
    },
    "query": "\n                WITH RECURSIVE\n                    base_task AS (\n                        SELECT\n                            t.id,\n                            t.title,\n                            (\n                                t.responsible_user_id = $1\n                            ) is_responsible,\n                            EXISTS (\n                                SELECT\n                                FROM\n                                    users_groups ug\n                                WHERE\n                                    ug.group_id = t.group_id AND\n                                    ug.user_id = $1\n                            ) is_in_group,\n                            t.completed_at,\n                            t.start_date,\n                            t.end_date,\n                            t.estimate,\n                            t.category_id,\n                            ts.subcategory_id,\n                            u.id as responsible_id,\n                            u.name as responsible_name,\n                            u.picture_url as responsible_picture_url,\n                            g.id as group_id,\n                            g.title as group_title,\n                            g.uid as group_uid,\n                            r.id as recurrence_id,\n                            r.frequency as recurrence_frequency,\n                            r.is_every as recurrence_is_every,\n                            r.current_task_id as recurrence_current_task_id,\n                            c.previous_task_id as recurrence_previous_task_id\n                        FROM\n                            tasks t\n                        INNER JOIN\n                            users u ON\n                                u.id = t.responsible_user_id\n                        LEFT JOIN\n                            groups g ON\n                                g.id = t.group_id\n                        LEFT JOIN\n                            recurrences r ON\n                                r.id = t.recurrence_id\n                        LEFT JOIN\n                            tasks c ON\n                                c.id = r.current_task_id\n                        LEFT JOIN\n                            tasks_subcategories ts ON\n                                ts.task_id = t.id AND\n                                ts.user_id = $1\n                        WHERE\n                            t.id = $2\n                    ),\n                    every_task AS (\n                        SELECT\n                            bt.*,\n                            0 depth\n                        FROM\n                            base_task bt\n                        WHERE\n                            bt.recurrence_is_every\n                        UNION ALL\n                        SELECT\n                            et.id,\n                            et.title,\n                            et.is_responsible,\n                            et.is_in_group,\n                            et.completed_at,\n                            (et.start_date + et.recurrence_frequency)::date,\n                            (et.end_date + et.recurrence_frequency)::date,\n                            et.estimate,\n                            et.category_id,\n                            et.subcategory_id,\n                            et.responsible_id,\n                            et.responsible_name,\n                            et.responsible_picture_url,\n                            et.group_id,\n                            et.group_title,\n                            et.group_uid,\n                            et.recurrence_id,\n                            et.recurrence_frequency,\n                            et.recurrence_is_every,\n                            et.recurrence_current_task_id,\n                            et.recurrence_previous_task_id,\n                            et.depth + 1\n                        FROM\n                            every_task et\n                        WHERE\n                            et.depth < $3 AND\n                            COALESCE(et.start_date, et.end_date) + et.recurrence_frequency < CURRENT_TIMESTAMP\n                    )\n                SELECT\n                    bt.id,\n                    bt.title,\n                    bt.is_responsible,\n                    bt.is_in_group,\n                    bt.completed_at,\n                    bt.completed_at < CURRENT_TIMESTAMP - INTERVAL '1 day' as is_old,\n                    bt.start_date,\n                    bt.end_date,\n                    bt.estimate,\n                    bt.category_id,\n                    bt.subcategory_id,\n                    bt.responsible_id,\n                    bt.responsible_name,\n                    bt.responsible_picture_url,\n                    bt.group_id as \"group_id: Option<i32>\",\n                    bt.group_title as \"group_title: Option<String>\",\n                    bt.group_uid as \"group_uid: Option<Uuid>\",\n                    bt.recurrence_id as \"recurrence_id: Option<i32>\",\n                    bt.recurrence_frequency as \"recurrence_frequency: Option<PgInterval>\",\n                    bt.recurrence_is_every as \"recurrence_is_every: Option<bool>\",\n                    bt.recurrence_current_task_id as \"recurrence_current_task_id: Option<i32>\",\n                    bt.recurrence_previous_task_id,\n                    (SELECT COUNT(*) FROM every_task et WHERE et.id = bt.id AND et.start_date < CURRENT_TIMESTAMP)::int as recurrence_num_ready_to_start,\n                    (SELECT COUNT(*) FROM every_task et WHERE et.id = bt.id AND et.end_date < CURRENT_TIMESTAMP)::int as recurrence_num_reached_deadline\n                FROM\n                    base_task bt\n            "
  },
  "1e59d0bc0b19919938c42f0ddc1f24e1411a9546a0d5d53c0e4b1f8ba3cf686b": {
    "describe": {
      "columns": [
        {
          "name": "id: TaskId",
          "ordinal": 0,
          "type_info": "Int4"
        }
      ],
      "nullable": [
        false
      ],
      "parameters": {
        "Left": [
          "Int4",
          "Text",
          "Date",
          "Date",
          "Int4",
          "Interval"
        ]
      }
    },
    "query": "\n                INSERT INTO tasks (\n                    responsible_user_id,\n                    title,\n                    start_date,\n                    end_date,\n                    group_id,\n                    estimate\n                )\n                VALUES (\n                    $1,\n                    $2,\n                    $3,\n                    $4,\n                    $5,\n                    $6\n                )\n                RETURNING\n                    id as \"id: TaskId\"\n            "
  },
  "29a2e90c1d7e246ccfc4bf02af698eb19ee28950e467990f2db633c79c71d1ae": {
    "describe": {
      "columns": [],
      "nullable": [],
      "parameters": {
        "Left": [
          "Interval",
          "Bool",
          "Int4"
        ]
      }
    },
    "query": "\n                WITH\n                    rec AS (\n                        INSERT INTO recurrences (\n                            frequency,\n                            is_every,\n                            current_task_id\n                        )\n                        VALUES (\n                            $1,\n                            $2,\n                            $3\n                        )\n                        RETURNING\n                            id\n                    )\n                UPDATE\n                    tasks t\n                SET\n                    recurrence_id = r.id\n                FROM\n                    rec r\n                WHERE\n                    t.id = $3\n            "
  },
  "33fb99aa9fd2ae03664e2ab838df099e673912f61ae5eff025a3ea5e5507909b": {
    "describe": {
      "columns": [],
      "nullable": [],
      "parameters": {
        "Left": [
          "Int4",
          "Int4"
        ]
      }
    },
    "query": "\n                UPDATE\n                    tasks t\n                SET\n                    group_id = NULL\n                WHERE\n                    t.responsible_user_id = $1 AND\n                    t.group_id = $2\n            "
  },
  "3ca8e3b2b68c196f66ab3faa7be66eb48a81a95bfa9a7b75bb9275a03c8443ef": {
    "describe": {
      "columns": [
        {
          "name": "completed_at",
          "ordinal": 0,
          "type_info": "Timestamp"
        }
      ],
      "nullable": [
        true
      ],
      "parameters": {
        "Left": [
          "Int4",
          "Int4",
          "Bool"
        ]
      }
    },
    "query": "\n                UPDATE\n                    tasks t\n                SET\n                    completed_at = CASE\n                        WHEN $3 THEN CURRENT_TIMESTAMP AT TIME ZONE 'UTC'\n                        ELSE NULL\n                    END\n                WHERE\n                    t.id = $2 AND\n                    -- Permission check\n                    (\n                        -- Viewer is responsible\n                        t.responsible_user_id = $1 OR\n                        -- Viewer is in task group\n                        EXISTS (\n                            SELECT\n                            FROM\n                                users_groups ug\n                            WHERE\n                                ug.group_id = t.group_id AND\n                                ug.user_id = $1\n                        )\n                    )\n                RETURNING\n                    completed_at\n            "
  },
  "3ee3b2e61ebcd26cb17cbb8aa4ed13ae25a5e344abfc4feb15d6de1ede745fa5": {
    "describe": {
      "columns": [],
      "nullable": [],
      "parameters": {
        "Left": [
          "Int4"
        ]
      }
    },
    "query": "\n                DELETE FROM\n                    recurrences r\n                WHERE\n                    r.id = $1\n            "
  },
  "4ebe4f8512bab12d12bef9622cb8a2abd1dcb7d4b346f24317888a669ac1019b": {
    "describe": {
      "columns": [],
      "nullable": [],
      "parameters": {
        "Left": [
          "Int4"
        ]
      }
    },
    "query": "\n                DELETE FROM\n                    groups g\n                WHERE\n                    id = $1 AND\n                    NOT EXISTS (\n                        SELECT\n                        FROM\n                            users_groups ug\n                        WHERE\n                            ug.group_id = g.id\n                    )\n            "
  },
  "5207d2887c50a44bf6d0b6b5c0a326dd595b1de1a1b0d9d40d8f2d723d1aea46": {
    "describe": {
      "columns": [],
      "nullable": [],
      "parameters": {
        "Left": [
          "Int4",
          "Int4"
        ]
      }
    },
    "query": "\n                UPDATE\n                    recurrences r\n                SET\n                    current_task_id = $1\n                WHERE\n                    r.current_task_id = $2\n            "
  },
  "589777393d7233abd707617793c848b9817c6b226146c1227db83ab88628b08c": {
    "describe": {
      "columns": [
        {
          "name": "id: SubcategoryId",
          "ordinal": 0,
          "type_info": "Int4"
        },
        {
          "name": "title",
          "ordinal": 1,
          "type_info": "Text"
        },
        {
          "name": "color",
          "ordinal": 2,
          "type_info": "Text"
        }
      ],
      "nullable": [
        false,
        false,
        true
      ],
      "parameters": {
        "Left": [
          "Int4",
          "Int4",
          "Text",
          "Text"
        ]
      }
    },
    "query": "\n                UPDATE\n                    subcategories\n                SET\n                    title = $3,\n                    color = $4\n                WHERE\n                    id = $2 AND\n                    user_id = $1\n                RETURNING\n                    id as \"id: SubcategoryId\",\n                    title,\n                    color\n            "
  },
  "67343a717492c0b43e38b452685c4d5abb43645fb403c685a3347f1f2a537d19": {
    "describe": {
      "columns": [
        {
          "name": "id: SubcategoryId",
          "ordinal": 0,
          "type_info": "Int4"
        },
        {
          "name": "title",
          "ordinal": 1,
          "type_info": "Text"
        },
        {
          "name": "color",
          "ordinal": 2,
          "type_info": "Text"
        }
      ],
      "nullable": [
        false,
        false,
        true
      ],
      "parameters": {
        "Left": [
          "Int4",
          "Int4",
          "Text",
          "Text"
        ]
      }
    },
    "query": "\n                INSERT INTO subcategories (\n                    user_id,\n                    category_id,\n                    title,\n                    color\n                ) VALUES (\n                    $1,\n                    $2,\n                    $3,\n                    $4\n                )\n                RETURNING\n                    id as \"id: SubcategoryId\",\n                    title,\n                    color\n            "
  },
  "6ce4ba473682291f826b9ce5d2294132014c9b7948993827ca9e5ffa34355523": {
    "describe": {
      "columns": [
        {
          "name": "id: UserId",
          "ordinal": 0,
          "type_info": "Int4"
        },
        {
          "name": "uid",
          "ordinal": 1,
          "type_info": "Text"
        },
        {
          "name": "name",
          "ordinal": 2,
          "type_info": "Text"
        },
        {
          "name": "picture_url",
          "ordinal": 3,
          "type_info": "Text"
        }
      ],
      "nullable": [
        false,
        false,
        false,
        true
      ],
      "parameters": {
        "Left": [
          "Text",
          "Text",
          "Text"
        ]
      }
    },
    "query": "\n                INSERT INTO users (\n                    uid,\n                    name,\n                    picture_url\n                )\n                VALUES (\n                    $1,\n                    $2,\n                    $3\n                )\n                ON CONFLICT (uid) DO UPDATE SET\n                    name = EXCLUDED.name,\n                    picture_url = EXCLUDED.picture_url\n                RETURNING\n                    id as \"id: UserId\",\n                    uid,\n                    name,\n                    picture_url\n            "
  },
  "6e870d88150f44d31ab5a45fdc47023291b08500df25938b2a67bf1bf1e7cec9": {
    "describe": {
      "columns": [
        {
          "name": "id",
          "ordinal": 0,
          "type_info": "Int4"
        },
        {
          "name": "title",
          "ordinal": 1,
          "type_info": "Text"
        },
        {
          "name": "is_responsible",
          "ordinal": 2,
          "type_info": "Bool"
        },
        {
          "name": "is_in_group",
          "ordinal": 3,
          "type_info": "Bool"
        },
        {
          "name": "completed_at",
          "ordinal": 4,
          "type_info": "Timestamp"
        },
        {
          "name": "is_old",
          "ordinal": 5,
          "type_info": "Bool"
        },
        {
          "name": "start_date",
          "ordinal": 6,
          "type_info": "Date"
        },
        {
          "name": "end_date",
          "ordinal": 7,
          "type_info": "Date"
        },
        {
          "name": "estimate",
          "ordinal": 8,
          "type_info": "Interval"
        },
        {
          "name": "category_id",
          "ordinal": 9,
          "type_info": "Int4"
        },
        {
          "name": "subcategory_id",
          "ordinal": 10,
          "type_info": "Int4"
        },
        {
          "name": "responsible_id",
          "ordinal": 11,
          "type_info": "Int4"
        },
        {
          "name": "responsible_name",
          "ordinal": 12,
          "type_info": "Text"
        },
        {
          "name": "responsible_picture_url",
          "ordinal": 13,
          "type_info": "Text"
        },
        {
          "name": "group_id: Option<i32>",
          "ordinal": 14,
          "type_info": "Int4"
        },
        {
          "name": "group_title: Option<String>",
          "ordinal": 15,
          "type_info": "Text"
        },
        {
          "name": "group_uid: Option<Uuid>",
          "ordinal": 16,
          "type_info": "Uuid"
        },
        {
          "name": "recurrence_id: Option<i32>",
          "ordinal": 17,
          "type_info": "Int4"
        },
        {
          "name": "recurrence_frequency: Option<PgInterval>",
          "ordinal": 18,
          "type_info": "Interval"
        },
        {
          "name": "recurrence_is_every: Option<bool>",
          "ordinal": 19,
          "type_info": "Bool"
        },
        {
          "name": "recurrence_current_task_id: Option<i32>",
          "ordinal": 20,
          "type_info": "Int4"
        },
        {
          "name": "recurrence_previous_task_id",
          "ordinal": 21,
          "type_info": "Int4"
        },
        {
          "name": "recurrence_num_ready_to_start",
          "ordinal": 22,
          "type_info": "Int4"
        },
        {
          "name": "recurrence_num_reached_deadline",
          "ordinal": 23,
          "type_info": "Int4"
        }
      ],
      "nullable": [
        false,
        false,
        null,
        null,
        true,
        null,
        true,
        true,
        true,
        true,
        false,
        false,
        false,
        true,
        false,
        false,
        false,
        false,
        false,
        false,
        false,
        true,
        null,
        null
      ],
      "parameters": {
        "Left": [
          "Int4",
          "Int4"
        ]
      }
    },
    "query": "\n                WITH RECURSIVE\n                    base_tasks AS (\n                        SELECT\n                            t.id,\n                            t.created_at,\n                            t.title,\n                            (\n                                t.responsible_user_id = $1\n                            ) is_responsible,\n                            EXISTS (\n                                SELECT\n                                FROM\n                                    users_groups ug\n                                WHERE\n                                    ug.group_id = t.group_id AND\n                                    ug.user_id = $1\n                            ) is_in_group,\n                            t.completed_at,\n                            t.start_date,\n                            t.end_date,\n                            t.estimate,\n                            t.category_id,\n                            ts.subcategory_id,\n                            u.id as responsible_id,\n                            u.name as responsible_name,\n                            u.picture_url as responsible_picture_url,\n                            g.id as group_id,\n                            g.title as group_title,\n                            g.uid as group_uid,\n                            r.id as recurrence_id,\n                            r.frequency as recurrence_frequency,\n                            r.is_every as recurrence_is_every,\n                            r.current_task_id as recurrence_current_task_id,\n                            c.previous_task_id as recurrence_previous_task_id\n                        FROM\n                            tasks t\n                        INNER JOIN\n                            users u ON\n                                u.id = t.responsible_user_id\n                        LEFT JOIN\n                            groups g ON\n                                g.id = t.group_id\n                        LEFT JOIN\n                            recurrences r ON\n                                r.id = t.recurrence_id\n                        LEFT JOIN\n                            tasks c ON\n                                c.id = r.current_task_id\n                        LEFT JOIN\n                            tasks_subcategories ts ON\n                                ts.task_id = t.id AND\n                                ts.user_id = $1\n                        WHERE\n                            -- Hide old items\n                            (\n                                t.completed_at IS NULL OR\n                                t.completed_at > CURRENT_TIMESTAMP - INTERVAL '1 day'\n                            ) AND\n                            -- Permission check\n                            (\n                                -- Viewer is responsible\n                                t.responsible_user_id = $1 OR\n                                -- Viewer is in task group\n                                EXISTS (\n                                    SELECT\n                                    FROM\n                                        users_groups ug\n                                    WHERE\n                                        ug.group_id = t.group_id AND\n                                        ug.user_id = $1\n                                ) OR\n                                -- Is friend responsible\n                                EXISTS (\n                                    SELECT\n                                    FROM\n                                        users_groups viewer_group\n                                    INNER JOIN\n                                        users_groups friend_group ON\n                                            friend_group.group_id = viewer_group.group_id\n                                    WHERE\n                                        viewer_group.user_id = $1 AND\n                                        friend_group.user_id = t.responsible_user_id\n                                )\n                            )\n                    ),\n                    every_tasks AS (\n                        SELECT\n                            bt.*,\n                            0 depth\n                        FROM\n                            base_tasks bt\n                        WHERE\n                            bt.recurrence_is_every\n                        UNION ALL\n                        SELECT\n                            et.id,\n                            et.created_at,\n                            et.title,\n                            et.is_responsible,\n                            et.is_in_group,\n                            et.completed_at,\n                            (et.start_date + et.recurrence_frequency)::date,\n                            (et.end_date + et.recurrence_frequency)::date,\n                            et.estimate,\n                            et.category_id,\n                            et.subcategory_id,\n                            et.responsible_id,\n                            et.responsible_name,\n                            et.responsible_picture_url,\n                            et.group_id,\n                            et.group_title,\n                            et.group_uid,\n                            et.recurrence_id,\n                            et.recurrence_frequency,\n                            et.recurrence_is_every,\n                            et.recurrence_current_task_id,\n                            et.recurrence_previous_task_id,\n                            et.depth + 1\n                        FROM\n                            every_tasks et\n                        WHERE\n                            et.depth < $2 AND\n                            COALESCE(et.start_date, et.end_date) + et.recurrence_frequency < CURRENT_TIMESTAMP\n                    )\n                SELECT\n                    bt.id,\n                    bt.title,\n                    bt.is_responsible,\n                    bt.is_in_group,\n                    bt.completed_at,\n                    false is_old,\n                    bt.start_date,\n                    bt.end_date,\n                    bt.estimate,\n                    bt.category_id,\n                    bt.subcategory_id,\n                    bt.responsible_id,\n                    bt.responsible_name,\n                    bt.responsible_picture_url,\n                    bt.group_id as \"group_id: Option<i32>\",\n                    bt.group_title as \"group_title: Option<String>\",\n                    bt.group_uid as \"group_uid: Option<Uuid>\",\n                    bt.recurrence_id as \"recurrence_id: Option<i32>\",\n                    bt.recurrence_frequency as \"recurrence_frequency: Option<PgInterval>\",\n                    bt.recurrence_is_every as \"recurrence_is_every: Option<bool>\",\n                    bt.recurrence_current_task_id as \"recurrence_current_task_id: Option<i32>\",\n                    bt.recurrence_previous_task_id,\n                    (SELECT COUNT(*) FROM every_tasks et WHERE et.id = bt.id AND et.start_date < CURRENT_TIMESTAMP)::int as recurrence_num_ready_to_start,\n                    (SELECT COUNT(*) FROM every_tasks et WHERE et.id = bt.id AND et.end_date < CURRENT_TIMESTAMP)::int as recurrence_num_reached_deadline\n                FROM\n                    base_tasks bt\n                ORDER BY\n                    bt.created_at\n            "
  },
  "792c754e379cb5de080a08b3fd0036ba44e3c372559d46fb879bfa22cce47239": {
    "describe": {
      "columns": [],
      "nullable": [],
      "parameters": {
        "Left": [
          "Interval",
          "Bool",
          "Int4"
        ]
      }
    },
    "query": "\n                UPDATE\n                    recurrences r\n                SET\n                    frequency = $1,\n                    is_every = $2\n                WHERE\n                    r.id = $3\n            "
  },
  "89634b2042189f891057f5fd5072eb4d6ca3067ec863fca212aca81df06880bf": {
    "describe": {
      "columns": [
        {
          "name": "id: TaskId",
          "ordinal": 0,
          "type_info": "Int4"
        }
      ],
      "nullable": [
        false
      ],
      "parameters": {
        "Left": [
          "Int4",
          "Int4"
        ]
      }
    },
    "query": "\n                DELETE FROM\n                    tasks t\n                WHERE\n                    t.id = $2 AND\n                    -- Permission check\n                    (\n                        -- Viewer is responsible\n                        t.responsible_user_id = $1 OR\n                        -- Viewer is in task group\n                        EXISTS (\n                            SELECT\n                            FROM\n                                users_groups ug\n                            WHERE\n                                ug.group_id = t.group_id AND\n                                ug.user_id = $1\n                        )\n                    )\n                RETURNING\n                    id as \"id: TaskId\"\n            "
  },
  "959dd1255da06b62f8350e2c1735f617ab83305fc0a274fa8c25ea1229297df0": {
    "describe": {
      "columns": [
        {
          "name": "id: GroupId",
          "ordinal": 0,
          "type_info": "Int4"
        },
        {
          "name": "title",
          "ordinal": 1,
          "type_info": "Text"
        },
        {
          "name": "uid",
          "ordinal": 2,
          "type_info": "Uuid"
        }
      ],
      "nullable": [
        false,
        false,
        false
      ],
      "parameters": {
        "Left": [
          "Text"
        ]
      }
    },
    "query": "\n                INSERT INTO groups (\n                    title\n                )\n                VALUES (\n                    $1\n                )\n                RETURNING\n                    id as \"id: GroupId\",\n                    title,\n                    uid\n            "
  },
  "99cb7feb76b5395b61af9edbffc05c5abd6bacb7d81db329075fe676b515cf42": {
    "describe": {
      "columns": [
        {
          "name": "id: TaskId",
          "ordinal": 0,
          "type_info": "Int4"
        }
      ],
      "nullable": [
        false
      ],
      "parameters": {
        "Left": [
          "Int4"
        ]
      }
    },
    "query": "\n                WITH\n                    new_task AS (\n                        INSERT INTO tasks (\n                            responsible_user_id,\n                            title,\n                            start_date,\n                            end_date,\n                            group_id,\n                            estimate,\n                            previous_task_id,\n                            recurrence_id\n                        )\n                        SELECT\n                            t.responsible_user_id,\n                            t.title,\n                            t.start_date + CASE\n                                WHEN r.is_every THEN\n                                    r.frequency\n                                ELSE\n                                    r.frequency +\n                                    (\n                                        CURRENT_DATE -\n                                        COALESCE(t.start_date, t.end_date)\n                                    ) * INTERVAL '1 day'\n                            END,\n                            t.end_date + CASE\n                                WHEN r.is_every THEN\n                                    r.frequency\n                                ELSE\n                                    r.frequency +\n                                    (\n                                        CURRENT_DATE -\n                                        COALESCE(t.start_date, t.end_date)\n                                    ) * INTERVAL '1 day'\n                            END,\n                            t.group_id,\n                            t.estimate,\n                            t.id,\n                            r.id\n                        FROM\n                            tasks t\n                        INNER JOIN\n                            recurrences r ON\n                                r.id = t.recurrence_id\n                        WHERE\n                            t.id = $1\n                        RETURNING\n                            id,\n                            recurrence_id\n                    )\n                UPDATE\n                    recurrences r\n                SET\n                    current_task_id = t.id\n                FROM\n                    new_task t\n                WHERE\n                    t.recurrence_id = r.id\n                RETURNING\n                    t.id as \"id: TaskId\"\n            "
  },
  "9c00bfa9e6f1fdd9e047dbb751bc96e1d1576d89f0acfd02ba615b641e397378": {
    "describe": {
      "columns": [],
      "nullable": [],
      "parameters": {
        "Left": [
          "Int4"
        ]
      }
    },
    "query": "\n                UPDATE\n                    tasks t\n                SET\n                    previous_task_id = NULL,\n                    recurrence_id = NULL\n                WHERE\n                    t.recurrence_id = $1\n            "
  },
  "9e73fabbb8d4aee1ebf4a1ad9c442c9e18ee096585fc71349664a46d9c3aac11": {
    "describe": {
      "columns": [
        {
          "name": "id: SubcategoryId",
          "ordinal": 0,
          "type_info": "Int4"
        }
      ],
      "nullable": [
        false
      ],
      "parameters": {
        "Left": [
          "Int4",
          "Int4"
        ]
      }
    },
    "query": "\n                DELETE FROM\n                    subcategories\n                WHERE\n                    id = $2 AND\n                    user_id = $1\n                RETURNING\n                    id as \"id: SubcategoryId\"\n            "
  },
  "9f4f3758dc89a08a53045521025882b21400c4e8c28369c3778dbf35a43a6f47": {
    "describe": {
      "columns": [
        {
          "name": "id: GroupId",
          "ordinal": 0,
          "type_info": "Int4"
        },
        {
          "name": "title",
          "ordinal": 1,
          "type_info": "Text"
        },
        {
          "name": "uid",
          "ordinal": 2,
          "type_info": "Uuid"
        }
      ],
      "nullable": [
        false,
        false,
        false
      ],
      "parameters": {
        "Left": [
          "Int4",
          "Int4",
          "Text"
        ]
      }
    },
    "query": "\n                UPDATE\n                    groups g\n                SET\n                    title = $3\n                WHERE\n                    g.id = $2 AND\n                    EXISTS (\n                        SELECT\n                        FROM\n                            users_groups ug\n                        WHERE\n                            ug.group_id = g.id AND\n                            ug.user_id = $1\n                    )\n                RETURNING\n                    id as \"id: GroupId\",\n                    title,\n                    uid\n            "
  },
  "b0209a352c2de8f2a02c78d266393ffbb5da9bd78bcff121fe387dfdf08230f8": {
    "describe": {
      "columns": [
        {
          "name": "id: CategoryId",
          "ordinal": 0,
          "type_info": "Int4"
        },
        {
          "name": "raw_title",
          "ordinal": 1,
          "type_info": "Text"
        },
        {
          "name": "color",
          "ordinal": 2,
          "type_info": "Text"
        },
        {
          "name": "is_enabled: Option<bool>",
          "ordinal": 3,
          "type_info": "Bool"
        },
        {
          "name": "subcategories: Json<Vec<SubcategoryResult>>",
          "ordinal": 4,
          "type_info": "Json"
        }
      ],
      "nullable": [
        false,
        false,
        true,
        false,
        null
      ],
      "parameters": {
        "Left": [
          "Int4"
        ]
      }
    },
    "query": "\n                SELECT\n                    c.id as \"id: CategoryId\",\n                    c.raw_title,\n                    co.color,\n                    co.is_enabled as \"is_enabled: Option<bool>\",\n                    (\n                        SELECT\n                            json_agg(json_build_object(\n                                'id', s.id,\n                                'title', s.title,\n                                'color', s.color\n                            ))\n                        FROM\n                            subcategories s\n                        WHERE\n                            s.category_id = c.id AND\n                            s.user_id = $1\n                    ) as \"subcategories: Json<Vec<SubcategoryResult>>\"\n                FROM\n                    categories c\n                LEFT JOIN\n                    categories_override co ON\n                        co.category_id = c.id AND\n                        co.user_id = $1\n                ORDER BY\n                    c.raw_title\n            "
  },
  "b5ed7df19e5ede92f355694fa31c4e8705912b793047812d28daf6c98b0073ed": {
    "describe": {
      "columns": [
        {
          "name": "id: GroupId",
          "ordinal": 0,
          "type_info": "Int4"
        },
        {
          "name": "title",
          "ordinal": 1,
          "type_info": "Text"
        },
        {
          "name": "uid",
          "ordinal": 2,
          "type_info": "Uuid"
        }
      ],
      "nullable": [
        false,
        false,
        false
      ],
      "parameters": {
        "Left": [
          "Uuid"
        ]
      }
    },
    "query": "\n                SELECT\n                    id as \"id: GroupId\",\n                    title,\n                    uid\n                FROM\n                    groups\n                WHERE\n                    uid = $1\n            "
  },
  "c42b3fe3bb44ec88e797bcba34bd09e399ee1feb4f61f847a77b21f95cf0ab9e": {
    "describe": {
      "columns": [],
      "nullable": [],
      "parameters": {
        "Left": [
          "Int4",
          "Int4"
        ]
      }
    },
    "query": "\n                DELETE FROM\n                    users_groups ug\n                WHERE\n                    ug.user_id = $1 AND\n                    ug.group_id = $2\n            "
  },
  "c69f2e7d3374e4881e9f0b7d13351e8646b318f1d4e3563545921190a8341f11": {
    "describe": {
      "columns": [],
      "nullable": [],
      "parameters": {
        "Left": [
          "Int4",
          "Int4"
        ]
      }
    },
    "query": "\n                INSERT INTO users_groups (\n                    user_id,\n                    group_id\n                )\n                VALUES (\n                    $1,\n                    $2\n                )\n            "
  },
  "d3bf0c822afaaec3180fcaaf1968d65987ed1a7a6f32d39476c2532cb7cc8060": {
    "describe": {
      "columns": [
        {
          "name": "id: CategoryId",
          "ordinal": 0,
          "type_info": "Int4"
        },
        {
          "name": "raw_title",
          "ordinal": 1,
          "type_info": "Text"
        },
        {
          "name": "color",
          "ordinal": 2,
          "type_info": "Text"
        },
        {
          "name": "is_enabled: Option<bool>",
          "ordinal": 3,
          "type_info": "Bool"
        },
        {
          "name": "subcategories: Json<Vec<SubcategoryResult>>",
          "ordinal": 4,
          "type_info": "Json"
        }
      ],
      "nullable": [
        false,
        false,
        true,
        false,
        null
      ],
      "parameters": {
        "Left": [
          "Int4",
          "Int4"
        ]
      }
    },
    "query": "\n                SELECT\n                    c.id as \"id: CategoryId\",\n                    c.raw_title,\n                    co.color,\n                    co.is_enabled as \"is_enabled: Option<bool>\",\n                    (\n                        SELECT\n                            json_agg(json_build_object(\n                                'id', s.id,\n                                'title', s.title,\n                                'color', s.color\n                            ))\n                        FROM\n                            subcategories s\n                        WHERE\n                            s.category_id = c.id AND\n                            s.user_id = $1\n                    ) as \"subcategories: Json<Vec<SubcategoryResult>>\"\n                FROM\n                    categories c\n                LEFT JOIN\n                    categories_override co ON\n                        co.category_id = c.id AND\n                        co.user_id = $1\n                WHERE\n                    c.id = $2\n            "
  },
  "ea07e2228de7a7e04e967f5970faf84108fe81657dba9c3c786cc2157989951a": {
    "describe": {
      "columns": [
        {
          "name": "id: GroupId",
          "ordinal": 0,
          "type_info": "Int4"
        },
        {
          "name": "title",
          "ordinal": 1,
          "type_info": "Text"
        },
        {
          "name": "uid",
          "ordinal": 2,
          "type_info": "Uuid"
        }
      ],
      "nullable": [
        false,
        false,
        false
      ],
      "parameters": {
        "Left": [
          "Int4"
        ]
      }
    },
    "query": "\n                SELECT\n                    g.id as \"id: GroupId\",\n                    g.title,\n                    g.uid\n                FROM\n                    groups g\n                INNER JOIN\n                    users_groups ug ON\n                        ug.group_id = g.id\n                WHERE\n                    ug.user_id = $1\n                ORDER BY\n                    g.created_at\n            "
  },
  "faf1bfc19670f94edb3ed58fb5b1fdd6bc9e61021b81462f244dd46a66c428f1": {
    "describe": {
      "columns": [],
      "nullable": [],
      "parameters": {
        "Left": [
          "Int4",
          "Int4",
          "Text",
          "Bool"
        ]
      }
    },
    "query": "\n                INSERT INTO categories_override (\n                    user_id,\n                    category_id,\n                    color,\n                    is_enabled\n                ) VALUES (\n                    $1,\n                    $2,\n                    $3,\n                    $4\n                ) ON CONFLICT (\n                    user_id,\n                    category_id\n                ) DO UPDATE SET\n                    color = EXCLUDED.color,\n                    is_enabled = EXCLUDED.is_enabled\n            "
  },
  "fb96380621e3048061609e3559381bbd403769f8caa2b0afa4235ce2d791936d": {
    "describe": {
      "columns": [
        {
          "name": "id: UserId",
          "ordinal": 0,
          "type_info": "Int4"
        }
      ],
      "nullable": [
        false
      ],
      "parameters": {
        "Left": [
          "Text"
        ]
      }
    },
    "query": "\n                INSERT INTO users (\n                    uid,\n                    name\n                )\n                VALUES (\n                    $1,\n                    '?'\n                )\n                ON CONFLICT (uid) DO UPDATE SET\n                    -- No-op to allow RETURNING\n                    uid = EXCLUDED.uid\n                RETURNING\n                    id as \"id: UserId\"\n            "
  }
}